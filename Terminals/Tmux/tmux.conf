# ~/.config/tmux/tmux.conf || tmux source ~/.config/tmux/tmux.conf

# TPM aktivieren
set -g @plugin 'tmux-plugins/tpm'

# Allgemeine Einstellungen
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g status-keys vi
setw -g mode-keys vi
set -g mouse on

## Tmux - Vim Integration
set -g @plugin 'christoomey/vim-tmux-navigator'

## Automatisches Benennen von Fenstern
set -g @plugin 'ofirgall/tmux-window-name'

## Fenster- und Pane-Nummerierung ab 1
set -g base-index 1
setw -g pane-base-index 1
set-option -g renumber-windows on

## Panes im aktuellen Verzeichnis öffnen
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

## Wiederherstellung von Tmux oder Neovim Sessions
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-nvim-session-file '~/.config/nvim/.tmux_session.nvim'

## Kopieren aus tmux in das OS
set -g @plugin 'tmux-plugins/tmux-yank'

## Präfix-Highlighter
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g status-right '#{prefix_highlight} | %a %Y-%m-%d %H:%M'

## Tmux-Treemux-Sidebar
set -g @treemux-tree-nvim-init-file '~/.config/tmux/plugins/treemux/configs/treemux_init.lua'
set -g @plugin 'kiyoon/treemux'

## Mouse-Swiping
set -g @plugin 'jaclu/tmux-mouse-swipe'

## FZF Plugin
set -g @plugin 'sainnhe/tmux-fzf'
set -g TMUX_FZF_LAUNCH_KEY 'C-f'

## Cargo Support
set -g @plugin 'idevtier/tmux-cargo'

## Tmux-Menü
set -g @plugin 'jaclu/tmux-menus'
set -g @menus_trigger 'F9'
set -g @menus_without_prefix 1 ## Öffnet das Menü ohne Präfix

# Tmux-Resurrect
set -g @resurrect-save 'SIGHUP SIGTERM'
set -g @resurrect-save-interval 1  # Speichert den Zustand alle 15 Minuten

# Tmux-Continuum
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'

# Weitere Plugins
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'christoomey/vim-tmux-navigator'

## Farben

## Tmux-Farben an Neovim anpassen (24-Bit Farben)
set-option -sa terminal-overrides ',xterm*:Tc'

## Themes
set -g @plugin 'dreamsofcode-io/catppuccin-tmux'
# set -g @plugin 'gpakosz/.tmux'
# set -g @plugin 'erikw/tmux-powerline'
# set -g @plugin 'vim-airline/vim-airline'
# set -g @plugin 'vim-airline/vim-airline-themes'

## Setzt Escape-Zeit auf 10ms für schnellere Reaktion
set-option -sg escape-time 10

## Fokus-Ereignisse aktivieren für bessere Integration mit Neovim's Autoread
set-option -g focus-events on

## Setzt das Terminal auf 256 Farben innerhalb von tmux
set-option -g default-terminal "tmux-256color"

## Aktiviert True-Color-Unterstützung
set-option -sa terminal-features ',xterm-256color:RGB'
set-option -a terminal-overrides ',xterm-256color:Tc'
export TERM=xterm-256color

# Tastenkombinationen

## Präfix von STRG-b auf Steuerung-Space setzen (optional)
# set -g prefix C-Space

## Füge eine Tastenkombination hinzu, um die aktuelle Sitzung zu beenden
bind-key X run-shell 'tmux kill-session -t $(tmux display-message -p "#S")'

## Kopiermodus wie in Vim
setw -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"

## TMUX NVIM
set -g @plugin 'aserowy/tmux.nvim'

## Tmux NVIM Windows integration
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?\.?(view|n?vim?x?)(-wrapped)?(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }

bind-key -T copy-mode-vi 'C-h' if -F '#{pane_at_left}' '' 'select-pane -L'
bind-key -T copy-mode-vi 'C-j' if -F '#{pane_at_bottom}' '' 'select-pane -D'
bind-key -T copy-mode-vi 'C-k' if -F '#{pane_at_top}' '' 'select-pane -U'
bind-key -T copy-mode-vi 'C-l' if -F '#{pane_at_right}' '' 'select-pane -R'

## TMUX NVIM Resize

is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind -n 'M-h' if-shell "$is_vim" 'send-keys M-h' 'resize-pane -L 1'
bind -n 'M-j' if-shell "$is_vim" 'send-keys M-j' 'resize-pane -D 1'
bind -n 'M-k' if-shell "$is_vim" 'send-keys M-k' 'resize-pane -U 1'
bind -n 'M-l' if-shell "$is_vim" 'send-keys M-l' 'resize-pane -R 1'

bind-key -T copy-mode-vi M-h resize-pane -L 1
bind-key -T copy-mode-vi M-j resize-pane -D 1
bind-key -T copy-mode-vi M-k resize-pane -U 1
bind-key -T copy-mode-vi M-l resize-pane -R 1

# Pfeiltasten Escape Sequenz verhindern
set-option -g terminal-overrides 'xterm*:smcup@:rmcup@'

# TPM bei Start von tmux ausführen
run-shell ~/.tmux/plugins/tpm/tpm

# Starte die TPM-Plugins
run '~/.tmux/plugins/tpm/tpm'

# Starte andere Skripte
run-shell ~/Software/copycat/copycat.tmux
run-shell ~/Software/tmuxyank/yank.tmux
run '~/.tmux/plugins/tpm/tpm'
